# Redis 集中过期问题处理
平时在操作Redis时，并没有延迟很大的情况发生，但在某个时间点突然出现一波延迟，现象： 变慢的时间很有规律，例如某个整点或间隔多久就会发生一波延迟。且慢查询日志中没有操作耗时的命令，但应用程序确感知到了延迟变大，其实时间都花费在删除过期Key上。

## 为什么集中过期会导致Redis延迟变大
参考:[Redis删除策略](./005.Redis删除策略.md) ，注意，这个主动过期Key的定时任务，是在Redis主线程中执行的。

也就是说，如果在执行主动过期过程中，出现了需要大量删除过期key的情况，那么此时应用程序在访问Redis时，必须要等待这个过期任务执行结束，Redis才可以服务这个客户端请求。

## 如何分析和排查


## 问题解决
1. 集中过期Key添加一个随机过期时间，把集中过期的时间打散，降低Redis清理过期Key的压力
2. 如果使用的是4.0以上的版本，可以开启lazy-free机制，当删除过期key时，把释放内存的操作放到后台线程中执行，避免阻塞主线程。